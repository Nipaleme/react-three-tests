{"ast":null,"code":"import _createForOfIteratorHelper from \"C:/Users/adrie/Downloads/react-three-fiber-threejs-meshline-example-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _slicedToArray from \"C:/Users/adrie/Downloads/react-three-fiber-threejs-meshline-example-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toArray from \"C:/Users/adrie/Downloads/react-three-fiber-threejs-meshline-example-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toArray\";\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, PCFSoftShadowMap, Vector3, Math as Math$1, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_scheduleCallback, unstable_cancelCallback, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { createContext, useState, useRef, useLayoutEffect, useCallback, useEffect, createElement, useContext, useMemo, memo } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport ResizeObserver from 'resize-observer-polyfill';\nvar version = \"3.0.3\";\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a),\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\nlet globalEffects = [];\n\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\n\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  const delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(sub => sub.ref.current(state.current, delta)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\n\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction _invalidate(state = true, frames = 2) {\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nlet catalogue = {};\n\nconst extend = objects => void (catalogue = _extends({}, catalogue, objects));\n\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => typeof newProps[key] === 'function' && key.startsWith('on'));\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => filteredProps[key] = undefined);\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const _entries$reverse = entries.reverse(),\n                  _entries$reverse2 = _toArray(_entries$reverse),\n                  name = _entries$reverse2[0],\n                  reverseEntries = _entries$reverse2.slice(1);\n\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) target.set(...value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) _invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref, container) {\n  let _ref$args = _ref.args,\n      args = _ref$args === void 0 ? [] : _ref$args,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [...parentInstance.children.slice(0, index), child, ...parentInstance.children.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, () => {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  schedulePassiveEffects: unstable_scheduleCallback,\n  cancelPassiveEffects: unstable_cancelCallback,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else if (instance.isObject3D) {\n      // Common Threejs scene object\n      applyProps(instance, newProps, oldProps, true);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\n\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\n\nconst hasSymbol = typeof Symbol === 'function' && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return event.object.uuid + '/' + event.index;\n}\n\nconst stateContext = createContext({});\n\nconst useCanvas = props => {\n  const children = props.children,\n        gl = props.gl,\n        camera = props.camera,\n        orthographic = props.orthographic,\n        raycaster = props.raycaster,\n        size = props.size,\n        rayBounds = props.rayBounds,\n        pixelRatio = props.pixelRatio,\n        _props$vr = props.vr,\n        vr = _props$vr === void 0 ? false : _props$vr,\n        _props$shadowMap = props.shadowMap,\n        shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n        _props$invalidateFram = props.invalidateFrameloop,\n        invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n        _props$updateDefaultC = props.updateDefaultCamera,\n        updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n        _props$noEvents = props.noEvents,\n        noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n        onCreated = props.onCreated,\n        onPointerMissed = props.onPointerMissed; // Local, reactive state\n\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        ready = _useState2[0],\n        setReady = _useState2[1];\n\n  const _useState3 = useState(() => new Vector2()),\n        _useState4 = _slicedToArray(_useState3, 1),\n        mouse = _useState4[0];\n\n  const _useState5 = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n        _useState6 = _slicedToArray(_useState5, 1),\n        defaultRaycaster = _useState6[0];\n\n  const _useState7 = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n        _useState8 = _slicedToArray(_useState7, 1),\n        defaultScene = _useState8[0];\n\n  const _useState9 = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n        _useState10 = _slicedToArray(_useState9, 2),\n        defaultCam = _useState10[0],\n        _setDefaultCamera = _useState10[1];\n\n  const _useState11 = useState(() => new Clock()),\n        _useState12 = _slicedToArray(_useState11, 1),\n        clock = _useState12[0]; // Public state\n\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n      };\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => _invalidate(state),\n    intersect: event => handlePointerMove(event || {})\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useLayoutEffect(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, noEvents, ready, size, defaultCam, gl]); // Update pixel ratio\n\n  useLayoutEffect(() => void (pixelRatio && gl.setPixelRatio(pixelRatio)), [pixelRatio]); // Update shadowmap\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // Adjusts default camera\n\n  useLayoutEffect(() => {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(state.current.camera)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = state.current.camera.position.distanceTo(target);\n      const fov = Math$1.degToRad(state.current.camera.fov); // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(state.current.camera)) {\n        state.current.camera.left = size.width / -2;\n        state.current.camera.right = size.width / 2;\n        state.current.camera.top = size.height / 2;\n        state.current.camera.bottom = size.height / -2;\n      } else {\n        state.current.camera.aspect = state.current.aspect;\n      }\n\n      state.current.camera.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      state.current.camera.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) _invalidate(state);\n  }, [size, updateDefaultCamera]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const IsReady = useCallback(() => {\n    const activate = () => setReady(true);\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useLayoutEffect(() => {\n    const _state$current = state.current,\n          props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render(createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        _invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      state.current.gl.forceContextLoss();\n      state.current.gl.dispose();\n      state.current.gl = undefined;\n      unmountComponentAtNode(state.current.scene);\n      state.current.active = false;\n    }\n  }, []);\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    if (event.clientX !== void 0) {\n      // #101: https://github.com/react-spring/react-three-fiber/issues/101\n      // The offset parent isn't taken into account by the resize observer\n      // let x = event.clientX\n      // let y = event.clientY\n      // if (event.target && event.target.offsetParent) {\n      //   x -= event.target.offsetParent.offsetLeft\n      //   y -= event.target.offsetParent.offsetTop\n      // }\n      const _rayBounds$current = rayBounds.current,\n            left = _rayBounds$current.left,\n            right = _rayBounds$current.right,\n            top = _rayBounds$current.top,\n            bottom = _rayBounds$current.bottom;\n      mouse.set((event.clientX - left) / (right - left) * 2 - 1, -((event.clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, prepare = true) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    const seen = new Set();\n    const hits = []; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    var _iterator = _createForOfIteratorHelper(intersects),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        let intersect = _step.value;\n        let eventObject = intersect.object; // Bubble event up\n\n        while (eventObject) {\n          const handlers = eventObject.__handlers;\n          if (handlers) hits.push(_extends({}, intersect, {\n            eventObject\n          }));\n          eventObject = eventObject.parent;\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    let dx = event.clientX - state.current.initialClick[0];\n    let dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((event, fn) => {\n    prepareRay(event); // If the interaction is captured, take the last known hit instead of raycasting again\n\n    const hits = state.current.captured && event.type !== 'click' && event.type !== 'wheel' ? state.current.captured : intersect(event, false);\n\n    if (hits.length) {\n      const unprojectedPoint = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      var _iterator2 = _createForOfIteratorHelper(hits),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          let hit = _step2.value;\n          let stopped = {\n            current: false\n          };\n          fn(_extends({}, event, hit, {\n            stopped,\n            delta,\n            unprojectedPoint,\n            ray: defaultRaycaster.ray,\n            // Hijack stopPropagation, which just sets a flag\n            stopPropagation: () => stopped.current = true,\n            sourceEvent: event\n          }));\n          if (stopped.current === true) break;\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    state.current.pointer.emit(name, event); // Collect hits\n\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click,\n        // which must must the initial target\n        if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if (name === 'click' && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  const hovered = new Map();\n  const handlePointerMove = useCallback(event => {\n    state.current.pointer.emit('pointerMove', event);\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerOut) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n        if (handlers && handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n          type: 'pointerout'\n        }));\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []);\n  return {\n    onClick: handlePointer('click'),\n    onWheel: handlePointer('wheel'),\n    onPointerDown: handlePointer('pointerDown'),\n    onPointerUp: handlePointer('pointerUp'),\n    onPointerLeave: e => handlePointerCancel(e, []),\n    onPointerMove: handlePointerMove,\n    onGotPointerCapture: e => state.current.captured = intersect(e, false),\n    onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n  };\n};\n\nfunction useFrame(callback, renderPriority = 0) {\n  const _useContext = useContext(stateContext),\n        subscribe = _useContext.subscribe; // Update ref\n\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority]);\n}\n\nfunction useRender(callback, takeOver) {\n  return useFrame(callback, takeOver ? 1 : 0);\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  const _useContext2 = useContext(stateContext),\n        invalidate = _useContext2.invalidate;\n\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  const _useState13 = useState(false),\n        _useState14 = _slicedToArray(_useState13, 2),\n        _ = _useState14[0],\n        forceUpdate = _useState14[1];\n\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => void forceUpdate(i => !i), [ref.current]);\n  return [ref, ref.current];\n}\n\nconst blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  const reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(name => delete reducedProps[name]); // Remove functions\n\n  Object.keys(reducedProps).forEach(name => typeof reducedProps[name] === 'function' && delete reducedProps[name]); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  const loader = useMemo(() => {\n    // Construct new loader\n    const temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  let results = usePromise((Proto, url) => {\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise(res => loader.load(url, data => {\n      const objects = [];\n      if (data.scene) data.scene.traverse(props => objects.push(prune(props)));\n      data.__$ = objects;\n      res(data);\n    }))));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  useEffect(() => () => results.forEach(data => {\n    if (data.dispose) data.dispose();\n    if (data.scene) data.scene.dispose();\n  }, [])); // Temporary hack to make the new api backwards compatible for a while ...\n\n  const isArray = Array.isArray(url);\n\n  if (!isArray) {\n    Object.assign(results[0], {\n      [Symbol.iterator]() {\n        console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n        return [results[0]][Symbol.iterator]();\n      }\n\n    });\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\n\nfunction useMeasure() {\n  const ref = useRef(null);\n\n  const _useState15 = useState({\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0,\n    bottom: 0,\n    right: 0,\n    x: 0,\n    y: 0\n  }),\n        _useState16 = _slicedToArray(_useState15, 2),\n        bounds = _useState16[0],\n        set = _useState16[1];\n\n  const _useState17 = useState(() => new ResizeObserver(() => ref.current && set(ref.current.getBoundingClientRect()))),\n        _useState18 = _slicedToArray(_useState17, 1),\n        ro = _useState18[0];\n\n  useEffect(() => {\n    if (ref.current) ro.observe(ref.current);\n    return () => ro.disconnect();\n  }, []);\n  const shouldRecalc = useRef(false);\n  const scrollBounds = useMemo(() => ({\n    _cache: bounds,\n\n    get current() {\n      if (shouldRecalc.current) {\n        shouldRecalc.current = false;\n        this._cache = ref.current.getBoundingClientRect();\n      }\n\n      return this._cache;\n    }\n\n  }), [bounds]);\n  useEffect(() => {\n    const onScroll = event => {\n      // Skip the check if flag already set\n      if (shouldRecalc.current) return;\n      shouldRecalc.current = event.target.contains(ref.current);\n    };\n\n    window.addEventListener('scroll', onScroll, {\n      capture: true,\n      passive: true\n    });\n    return () => window.removeEventListener('scroll', onScroll, true);\n  }, []);\n  return [ref, bounds, scrollBounds];\n}\n\nconst IsReady = memo(_ref => {\n  let setEvents = _ref.setEvents,\n      canvas = _ref.canvas,\n      props = _objectWithoutPropertiesLoose(_ref, [\"setEvents\", \"canvas\"]);\n\n  const gl = useMemo(() => new WebGLRenderer(_extends({\n    canvas,\n    antialias: true,\n    alpha: true\n  }, props.gl)), []); // Init canvas, fetch events, hand them back to the warpping div\n\n  const events = useCanvas(_extends({}, props, {\n    gl\n  }));\n  useEffect(() => void setEvents(events), [events]);\n  return null;\n});\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\nconst Canvas = memo(props => {\n  const style = props.style,\n        restSpread = _objectWithoutPropertiesLoose(props, [\"children\", \"vr\", \"shadowMap\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"style\", \"onCreated\", \"onPointerMissed\"]);\n\n  const canvasRef = useRef();\n\n  const _useState19 = useState({}),\n        _useState20 = _slicedToArray(_useState19, 2),\n        events = _useState20[0],\n        setEvents = _useState20[1];\n\n  const _useMeasure = useMeasure(),\n        _useMeasure2 = _slicedToArray(_useMeasure, 3),\n        bind = _useMeasure2[0],\n        size = _useMeasure2[1],\n        rayBounds = _useMeasure2[2]; // Allow Gatsby, Next and other server side apps to run.\n  // Will output styles to reduce flickering.\n\n\n  if (typeof window === 'undefined') {\n    return createElement(\"div\", {\n      style: _extends({}, defaultStyles, style)\n    }, createElement(\"canvas\", {\n      style: {\n        display: 'block'\n      }\n    }));\n  } // Render the canvas into the dom\n\n\n  return createElement(\"div\", _extends({\n    ref: bind,\n    style: _extends({}, defaultStyles, style)\n  }, events, restSpread), createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'block'\n    }\n  }), canvasRef.current && createElement(IsReady, _extends({}, props, {\n    size: size,\n    rayBounds: rayBounds,\n    canvas: canvasRef.current,\n    setEvents: setEvents\n  })));\n});\nexport { Canvas, Renderer, addEffect, applyProps, createPortal, extend, _invalidate as invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCanvas, useFrame, useLoader, useRender, useResource, useThree, useUpdate };","map":{"version":3,"sources":["C:/Users/adrie/Downloads/react-three-fiber-threejs-meshline-example-forked/node_modules/react-three-fiber/dist/web.js"],"names":["_objectWithoutPropertiesLoose","_extends","THREE","Layers","Vector2","Raycaster","Scene","OrthographicCamera","PerspectiveCamera","Clock","PCFSoftShadowMap","Vector3","Math","Math$1","WebGLRenderer","Reconciler","unstable_now","unstable_scheduleCallback","unstable_cancelCallback","unstable_runWithPriority","unstable_IdlePriority","createContext","useState","useRef","useLayoutEffect","useCallback","useEffect","createElement","useContext","useMemo","memo","TinyEmitter","usePromise","ResizeObserver","version","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","roots","Map","emptyObject","is","obj","a","Object","str","num","und","arr","Array","isArray","equ","b","i","globalEffects","addEffect","callback","push","renderGl","state","timestamp","repeat","runGlobalEffects","forEach","effect","delta","current","clock","getDelta","subscribers","sub","ref","frames","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","keys","filter","handlers","startsWith","leftOvers","filteredProps","reduce","acc","prop","rest","map","length","entries","value","includes","target","split","set","reverse","name","reverseEntries","copy","constructor","invalidateInstance","raycast","__handlers","index","__interaction","indexOf","splice","charAt","toLowerCase","substr","parent","updateInstance","update","createInstance","type","_ref","args","props","toUpperCase","slice","object","__instance","__objects","appendChild","parentInstance","child","isObject3D","add","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","children","removeRecursive","array","clone","removeChild","remove","x","dispose","switchInstance","fiber","newInstance","alternate","stateNode","Renderer","now","supportsMutation","isPrimaryRenderer","schedulePassiveEffects","cancelPassiveEffects","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hasNewArgs","some","val","hideInstance","visible","unhideInstance","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","element","get","newRoot","createContainer","updateContainer","getPublicRootInstance","unmountComponentAtNode","delete","hasSymbol","for","REACT_PORTAL_TYPE","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","rendererPackageName","findHostInstanceByFiber","findHostInstance","isOrthographicCamera","def","makeId","event","uuid","stateContext","useCanvas","orthographic","raycaster","size","rayBounds","pixelRatio","shadowMap","updateDefaultCamera","noEvents","onCreated","onPointerMissed","setReady","mouse","ray","raycasterProps","defaultRaycaster","defaultScene","cam","position","z","defaultCam","_setDefaultCamera","aspect","viewport","width","height","factor","initialClick","initialHits","pointer","captured","subscribe","priority","sort","s","setDefaultCamera","intersect","handlePointerMove","setPixelRatio","enabled","assign","distance","distanceTo","fov","degToRad","tan","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","IsReady","activate","result","then","sharedState","_state$current","Provider","setAnimationLoop","t","console","warn","forceContextLoss","prepareRay","clientX","clientY","setFromCamera","prepare","seen","Set","hits","intersects","intersectObjects","item","id","has","eventObject","calculateDistance","dx","dy","round","sqrt","handleIntersects","fn","unprojectedPoint","y","unproject","hit","stopped","stopPropagation","sourceEvent","handlePointer","emit","data","hovered","pointerMove","pointerOver","pointerOut","hoveredItem","handlePointerCancel","from","values","find","onClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCapture","onLostPointerCapture","useFrame","renderPriority","unsubscribe","useRender","takeOver","useThree","useUpdate","dependents","optionalRef","localRef","useResource","_","forceUpdate","blackList","prune","reducedProps","material","geometry","useLoader","Proto","url","extensions","loader","temp","results","urlArray","Promise","all","load","traverse","__$","iterator","useMeasure","bounds","getBoundingClientRect","ro","observe","disconnect","shouldRecalc","scrollBounds","_cache","onScroll","contains","window","addEventListener","capture","passive","removeEventListener","setEvents","canvas","antialias","alpha","events","defaultStyles","overflow","Canvas","style","restSpread","canvasRef","bind","display"],"mappings":"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","sourcesContent":["import _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, PCFSoftShadowMap, Vector3, Math as Math$1, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_scheduleCallback, unstable_cancelCallback, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { createContext, useState, useRef, useLayoutEffect, useCallback, useEffect, createElement, useContext, useMemo, memo } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nvar version = \"3.0.3\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a),\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\nlet globalEffects = [];\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  const delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(sub => sub.ref.current(state.current, delta)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 2) {\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nlet catalogue = {};\nconst extend = objects => void (catalogue = _extends({}, catalogue, objects));\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => typeof newProps[key] === 'function' && key.startsWith('on'));\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => filteredProps[key] = undefined);\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) target.set(...value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref, container) {\n  let {\n    args = []\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [...parentInstance.children.slice(0, index), child, ...parentInstance.children.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, () => {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  schedulePassiveEffects: unstable_scheduleCallback,\n  cancelPassiveEffects: unstable_cancelCallback,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else if (instance.isObject3D) {\n      // Common Threejs scene object\n      applyProps(instance, newProps, oldProps, true);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = []\n      } = newProps,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const {\n        args: argsOld = []\n      } = oldProps,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\nconst hasSymbol = typeof Symbol === 'function' && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return event.object.uuid + '/' + event.index;\n}\n\nconst stateContext = createContext({});\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    rayBounds,\n    pixelRatio,\n    vr = false,\n    shadowMap = false,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, _setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n      };\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: event => handlePointerMove(event || {})\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useLayoutEffect(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, noEvents, ready, size, defaultCam, gl]); // Update pixel ratio\n\n  useLayoutEffect(() => void (pixelRatio && gl.setPixelRatio(pixelRatio)), [pixelRatio]); // Update shadowmap\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // Adjusts default camera\n\n  useLayoutEffect(() => {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(state.current.camera)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = state.current.camera.position.distanceTo(target);\n      const fov = Math$1.degToRad(state.current.camera.fov); // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(state.current.camera)) {\n        state.current.camera.left = size.width / -2;\n        state.current.camera.right = size.width / 2;\n        state.current.camera.top = size.height / 2;\n        state.current.camera.bottom = size.height / -2;\n      } else {\n        state.current.camera.aspect = state.current.aspect;\n      }\n\n      state.current.camera.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      state.current.camera.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [size, updateDefaultCamera]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const IsReady = useCallback(() => {\n    const activate = () => setReady(true);\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useLayoutEffect(() => {\n    const _state$current = state.current,\n          props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render(createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      state.current.gl.forceContextLoss();\n      state.current.gl.dispose();\n      state.current.gl = undefined;\n      unmountComponentAtNode(state.current.scene);\n      state.current.active = false;\n    }\n  }, []);\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    if (event.clientX !== void 0) {\n      // #101: https://github.com/react-spring/react-three-fiber/issues/101\n      // The offset parent isn't taken into account by the resize observer\n      // let x = event.clientX\n      // let y = event.clientY\n      // if (event.target && event.target.offsetParent) {\n      //   x -= event.target.offsetParent.offsetLeft\n      //   y -= event.target.offsetParent.offsetTop\n      // }\n      const {\n        left,\n        right,\n        top,\n        bottom\n      } = rayBounds.current;\n      mouse.set((event.clientX - left) / (right - left) * 2 - 1, -((event.clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, prepare = true) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    const seen = new Set();\n    const hits = []; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (let intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, intersect, {\n          eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    let dx = event.clientX - state.current.initialClick[0];\n    let dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((event, fn) => {\n    prepareRay(event); // If the interaction is captured, take the last known hit instead of raycasting again\n\n    const hits = state.current.captured && event.type !== 'click' && event.type !== 'wheel' ? state.current.captured : intersect(event, false);\n\n    if (hits.length) {\n      const unprojectedPoint = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      for (let hit of hits) {\n        let stopped = {\n          current: false\n        };\n        fn(_extends({}, event, hit, {\n          stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => stopped.current = true,\n          sourceEvent: event\n        }));\n        if (stopped.current === true) break;\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    state.current.pointer.emit(name, event); // Collect hits\n\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click,\n        // which must must the initial target\n        if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if (name === 'click' && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  const hovered = new Map();\n  const handlePointerMove = useCallback(event => {\n    state.current.pointer.emit('pointerMove', event);\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerOut) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n        if (handlers && handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n          type: 'pointerout'\n        }));\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []);\n  return {\n    onClick: handlePointer('click'),\n    onWheel: handlePointer('wheel'),\n    onPointerDown: handlePointer('pointerDown'),\n    onPointerUp: handlePointer('pointerUp'),\n    onPointerLeave: e => handlePointerCancel(e, []),\n    onPointerMove: handlePointerMove,\n    onGotPointerCapture: e => state.current.captured = intersect(e, false),\n    onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n  };\n};\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority]);\n}\nfunction useRender(callback, takeOver) {\n  return useFrame(callback, takeOver ? 1 : 0);\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => void forceUpdate(i => !i), [ref.current]);\n  return [ref, ref.current];\n}\nconst blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  const reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(name => delete reducedProps[name]); // Remove functions\n\n  Object.keys(reducedProps).forEach(name => typeof reducedProps[name] === 'function' && delete reducedProps[name]); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  const loader = useMemo(() => {\n    // Construct new loader\n    const temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  let results = usePromise((Proto, url) => {\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise(res => loader.load(url, data => {\n      const objects = [];\n      if (data.scene) data.scene.traverse(props => objects.push(prune(props)));\n      data.__$ = objects;\n      res(data);\n    }))));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  useEffect(() => () => results.forEach(data => {\n    if (data.dispose) data.dispose();\n    if (data.scene) data.scene.dispose();\n  }, [])); // Temporary hack to make the new api backwards compatible for a while ...\n\n  const isArray = Array.isArray(url);\n\n  if (!isArray) {\n    Object.assign(results[0], {\n      [Symbol.iterator]() {\n        console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n        return [results[0]][Symbol.iterator]();\n      }\n\n    });\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\n\nfunction useMeasure() {\n  const ref = useRef(null);\n  const [bounds, set] = useState({\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0,\n    bottom: 0,\n    right: 0,\n    x: 0,\n    y: 0\n  });\n  const [ro] = useState(() => new ResizeObserver(() => ref.current && set(ref.current.getBoundingClientRect())));\n  useEffect(() => {\n    if (ref.current) ro.observe(ref.current);\n    return () => ro.disconnect();\n  }, []);\n  const shouldRecalc = useRef(false);\n  const scrollBounds = useMemo(() => ({\n    _cache: bounds,\n\n    get current() {\n      if (shouldRecalc.current) {\n        shouldRecalc.current = false;\n        this._cache = ref.current.getBoundingClientRect();\n      }\n\n      return this._cache;\n    }\n\n  }), [bounds]);\n  useEffect(() => {\n    const onScroll = event => {\n      // Skip the check if flag already set\n      if (shouldRecalc.current) return;\n      shouldRecalc.current = event.target.contains(ref.current);\n    };\n\n    window.addEventListener('scroll', onScroll, {\n      capture: true,\n      passive: true\n    });\n    return () => window.removeEventListener('scroll', onScroll, true);\n  }, []);\n  return [ref, bounds, scrollBounds];\n}\n\nconst IsReady = memo((_ref) => {\n  let {\n    setEvents,\n    canvas\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"setEvents\", \"canvas\"]);\n\n  const gl = useMemo(() => new WebGLRenderer(_extends({\n    canvas,\n    antialias: true,\n    alpha: true\n  }, props.gl)), []); // Init canvas, fetch events, hand them back to the warpping div\n\n  const events = useCanvas(_extends({}, props, {\n    gl\n  }));\n  useEffect(() => void setEvents(events), [events]);\n  return null;\n});\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\nconst Canvas = memo(props => {\n  const {\n    style\n  } = props,\n        restSpread = _objectWithoutPropertiesLoose(props, [\"children\", \"vr\", \"shadowMap\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"style\", \"onCreated\", \"onPointerMissed\"]);\n\n  const canvasRef = useRef();\n  const [events, setEvents] = useState({});\n  const [bind, size, rayBounds] = useMeasure(); // Allow Gatsby, Next and other server side apps to run.\n  // Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') {\n    return createElement(\"div\", {\n      style: _extends({}, defaultStyles, style)\n    }, createElement(\"canvas\", {\n      style: {\n        display: 'block'\n      }\n    }));\n  } // Render the canvas into the dom\n\n\n  return createElement(\"div\", _extends({\n    ref: bind,\n    style: _extends({}, defaultStyles, style)\n  }, events, restSpread), createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'block'\n    }\n  }), canvasRef.current && createElement(IsReady, _extends({}, props, {\n    size: size,\n    rayBounds: rayBounds,\n    canvas: canvasRef.current,\n    setEvents: setEvents\n  })));\n});\n\nexport { Canvas, Renderer, addEffect, applyProps, createPortal, extend, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCanvas, useFrame, useLoader, useRender, useResource, useThree, useUpdate };\n"]},"metadata":{},"sourceType":"module"}